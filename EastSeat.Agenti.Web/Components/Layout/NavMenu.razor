@implements IDisposable
@inject NavigationManager NavigationManager

<MudNavMenu>
    <AuthorizeView>
        <Authorized>
            <MudNavLink Href="" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">
                Home
            </MudNavLink>
            <MudNavLink Href="cashcount" Icon="@Icons.Material.Filled.AccountBalanceWallet">
                Cash Count
            </MudNavLink>
            <MudNavLink Href="cashsessions" Icon="@Icons.Material.Filled.EventNote">
                Cash Sessions
            </MudNavLink>
            <MudNavLink Href="agents" Icon="@Icons.Material.Filled.People">
                Agents
            </MudNavLink>
            <MudNavLink Href="wallettypes" Icon="@Icons.Material.Filled.Wallet">
                Wallet Types
            </MudNavLink>
            <AuthorizeView Policy="VaultAccess">
                <Authorized Context="vaultCtx">
                    <MudNavLink Href="vault" Icon="@Icons.Material.Filled.SafetyDivider">
                        Vault
                    </MudNavLink>
                </Authorized>
            </AuthorizeView>
            <AuthorizeView Policy="UserManagement">
                <Authorized Context="adminCtx">
                    <MudNavLink Href="users" Icon="@Icons.Material.Filled.ManageAccounts">
                        Users
                    </MudNavLink>
                </Authorized>
            </AuthorizeView>
        </Authorized>
        <NotAuthorized>
            <MudNavLink Href="Account/Register" Icon="@Icons.Material.Filled.PersonAdd">
                Register
            </MudNavLink>
            <MudNavLink Href="Account/Login" Icon="@Icons.Material.Filled.Login">
                Login
            </MudNavLink>
        </NotAuthorized>
    </AuthorizeView>
</MudNavMenu>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}